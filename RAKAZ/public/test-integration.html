<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeebly Delivery Test Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .status-badge { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .log-entry { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #667eea; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">ğŸ§ª Ù„ÙˆØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„</h1>
                    <p class="text-purple-200 mt-1">Jeebly Delivery Integration - Ø±Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠ</p>
                </div>
                <div class="flex items-center gap-4">
                    <div id="connectionStatus" class="bg-white/20 backdrop-blur rounded-lg px-4 py-2">
                        <span class="text-sm">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</span>
                        <span id="connectionStatusText" class="font-bold text-xl mr-2">ØºÙŠØ± Ù…ØªØµÙ„</span>
                    </div>
                    <button onclick="testConnection()" class="bg-white/20 hover:bg-white/30 transition p-2 rounded-lg" title="Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„">
                        ğŸ”Œ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Column: Configuration & Order Simulator -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Configuration Section -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-3xl">âš™ï¸</span>
                        <h2 class="text-xl font-bold text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Jeebly Settings -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-purple-600 flex items-center gap-2">
                                <span>ğŸ“¦</span> Jeebly API
                            </h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client Key</label>
                                <input type="text" id="jeeblyClientKey"
                                    value="967X250731093419Y4d6f7374616661536862616972"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-sm font-mono">
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="font-semibold text-purple-600 flex items-center gap-2">
                                <span>ğŸ”‘</span> API Key
                            </h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">X-API-KEY</label>
                                <input type="text" id="jeeblyApiKey"
                                    value="JjEeEeBbLlYy1200"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-sm font-mono">
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="font-semibold text-purple-600 flex items-center gap-2">
                                <span>ğŸŒ</span> Base URL
                            </h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Base URL</label>
                                <input type="text" id="jeeblyBaseUrl"
                                    value="https://demo.jeebly.com"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-sm font-mono">
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-blue-50 rounded-lg flex items-center justify-between">
                        <p class="text-sm text-blue-700">ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ø§ Ø±Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø¹ Jeebly API - Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹</p>
                        <button onclick="testConnection()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
                            ğŸ”Œ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                </section>

                <!-- Order Simulator -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">ğŸ“</span>
                            <h2 class="text-xl font-bold text-gray-800">Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                        </div>
                        <button onclick="runBulkTest()" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-lg hover:shadow-lg transition flex items-center gap-2">
                            <span>ğŸš€</span> Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ (5 Ø·Ù„Ø¨Ø§Øª)
                        </button>
                    </div>

                    <form id="orderForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <input type="text" id="customerName" required
                                    placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="customerPhone" required
                                    placeholder="967XXXXXXXXX"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <textarea id="customerAddress" required rows="2"
                                placeholder="ØµÙ†Ø¹Ø§Ø¡ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬Ø§Ù†Ø¨..."
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition resize-none"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ (Ø±.ÙŠ)</label>
                                <input type="number" id="orderValue" required min="1"
                                    placeholder="5000"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø±.ÙŠ)</label>
                                <input type="number" id="deliveryFee" value="500" min="0"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                                <input type="text" id="productDescription"
                                    placeholder="Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-lg hover:shadow-lg transition font-semibold flex items-center justify-center gap-2">
                                <span>ğŸ“¤</span> Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Jeebly
                            </button>
                        </div>
                    </form>
                </section>

                <!-- Jeebly Response Section -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-3xl">ğŸ“¦</span>
                        <h2 class="text-xl font-bold text-gray-800">Ø§Ø³ØªØ¬Ø§Ø¨Ø© Jeebly API</h2>
                    </div>

                    <div>
                        <h3 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            <span class="w-3 h-3 bg-purple-500 rounded-full"></span>
                            Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                        </h3>
                        <div id="jeeblyResponse" class="bg-gray-900 text-purple-400 rounded-lg p-4 font-mono text-sm h-48 overflow-auto">
                            <span class="text-gray-500">// Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªÙˆØµÙŠÙ„...</span>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Webhook Monitor & Status -->
            <div class="space-y-6">

                <!-- Webhook Monitor -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ“¡</span>
                            <h2 class="text-lg font-bold text-gray-800">Ù…Ø±Ø§Ù‚Ø¨ Webhook</h2>
                        </div>
                        <span class="status-badge bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">Ù…Ø¨Ø§Ø´Ø±</span>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Webhook URL</label>
                        <input type="text" readonly
                            value="https://boulevard.r-y-x.net/api/v1/Courier/UpdateCourierStatus"
                            class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-xs font-mono">
                    </div>

                    <!-- Manual Status Simulation -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ©</label>
                        <div class="flex gap-2">
                            <select id="manualStatus" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="Assigned">ğŸ“‹ Assigned - ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</option>
                                <option value="Out for Delivery">ğŸšš Out for Delivery - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                                <option value="Delivered">âœ… Delivered - ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                                <option value="Cancelled">âŒ Cancelled - Ù…Ù„ØºÙŠ</option>
                                <option value="Low Wallet Balance">âš ï¸ Low Wallet Balance - Ø±ØµÙŠØ¯ Ù…Ù†Ø®ÙØ¶</option>
                            </select>
                            <button onclick="simulateWebhook()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                Ø¥Ø±Ø³Ø§Ù„
                            </button>
                        </div>
                    </div>

                    <!-- Webhook Events -->
                    <div class="space-y-2 max-h-64 overflow-auto" id="webhookEvents">
                        <div class="text-center text-gray-400 text-sm py-4">
                            Ù„Ù… ØªØµÙ„ Ø£ÙŠ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¨Ø¹Ø¯...
                        </div>
                    </div>
                </section>

                <!-- Track Order -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-2xl">ğŸ”</span>
                        <h2 class="text-lg font-bold text-gray-800">ØªØªØ¨Ø¹ Ø·Ù„Ø¨</h2>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input type="text" id="trackOrderId" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ù„: E251230XXXXX)"
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        <button onclick="trackOrder()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                            ğŸ” ØªØªØ¨Ø¹
                        </button>
                    </div>

                    <div id="trackingResult" class="hidden">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-semibold text-gray-700">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</span>
                                <span id="trackingStatus" class="px-3 py-1 rounded-full text-sm font-semibold"></span>
                            </div>
                            <div id="trackingDetails" class="text-sm text-gray-600 space-y-2"></div>
                        </div>
                    </div>
                </section>

                <!-- Active Orders -->
                <section class="bg-white rounded-2xl card-shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ“‹</span>
                            <h2 class="text-lg font-bold text-gray-800">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h2>
                        </div>
                        <button onclick="refreshActiveOrders()" class="text-purple-600 hover:text-purple-800 text-sm">
                            ğŸ”„ ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>

                    <div id="activeOrders" class="space-y-3 max-h-64 overflow-auto">
                        <div class="text-center text-gray-400 text-sm py-4">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©
                        </div>
                    </div>
                </section>

                <!-- Quick Stats -->
                <section class="bg-gradient-to-br from-purple-600 to-indigo-700 rounded-2xl card-shadow p-6 text-white">
                    <h3 class="font-bold mb-4">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/20 rounded-lg p-3 text-center">
                            <div id="totalOrders" class="text-2xl font-bold">0</div>
                            <div class="text-xs text-purple-200">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3 text-center">
                            <div id="successfulOrders" class="text-2xl font-bold">0</div>
                            <div class="text-xs text-purple-200">Ø·Ù„Ø¨Ø§Øª Ù†Ø§Ø¬Ø­Ø©</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3 text-center">
                            <div id="failedOrders" class="text-2xl font-bold">0</div>
                            <div class="text-xs text-purple-200">Ø·Ù„Ø¨Ø§Øª ÙØ§Ø´Ù„Ø©</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3 text-center">
                            <div id="totalAmount" class="text-2xl font-bold">0</div>
                            <div class="text-xs text-purple-200">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Logs Section -->
        <section class="mt-6 bg-white rounded-2xl card-shadow p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ“œ</span>
                    <h2 class="text-xl font-bold text-gray-800">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
                </div>
                <div class="flex gap-2">
                    <button onclick="filterLogs('all')" class="log-filter active px-3 py-1 rounded-lg text-sm bg-gray-200 hover:bg-gray-300 transition" data-filter="all">Ø§Ù„ÙƒÙ„</button>
                    <button onclick="filterLogs('success')" class="log-filter px-3 py-1 rounded-lg text-sm bg-green-100 text-green-700 hover:bg-green-200 transition" data-filter="success">Ù†Ø¬Ø§Ø­</button>
                    <button onclick="filterLogs('error')" class="log-filter px-3 py-1 rounded-lg text-sm bg-red-100 text-red-700 hover:bg-red-200 transition" data-filter="error">Ø®Ø·Ø£</button>
                    <button onclick="filterLogs('info')" class="log-filter px-3 py-1 rounded-lg text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 transition" data-filter="info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
                    <button onclick="clearLogs()" class="px-3 py-1 rounded-lg text-sm bg-red-500 text-white hover:bg-red-600 transition">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                </div>
            </div>

            <div id="logsContainer" class="bg-gray-900 rounded-lg p-4 h-64 overflow-auto font-mono text-sm">
                <div class="text-gray-500">// Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
            </div>
        </section>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 left-4 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <div class="bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3">
            <span id="toastIcon">âœ…</span>
            <span id="toastMessage">Ø±Ø³Ø§Ù„Ø©</span>
        </div>
    </div>

    <!-- Low Balance Alert Modal -->
    <div id="lowBalanceModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-md mx-4 transform scale-95 transition">
            <div class="text-center">
                <span class="text-6xl">âš ï¸</span>
                <h3 class="text-xl font-bold text-gray-800 mt-4">ØªÙ†Ø¨ÙŠÙ‡: Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù†Ø®ÙØ¶!</h3>
                <p class="text-gray-600 mt-2">Ø±ØµÙŠØ¯ Ù…Ø­ÙØ¸Ø© Jeebly Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Jeebly Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©.</p>
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-yellow-700 font-semibold">ØªÙˆØ§ØµÙ„ Ù…Ø¹: navneet@jeebly.com</p>
                </div>
                <button onclick="closeLowBalanceModal()" class="mt-4 bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition">
                    Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Configuration ====================
        const CONFIG = {
            // Laravel API base URL (same domain)
            laravelApiUrl: '/api/jeebly',
            jeebly: {
                baseUrl: 'https://demo.jeebly.com',
                clientKey: '967X250731093419Y4d6f7374616661536862616972',
                apiKey: 'JjEeEeBbLlYy1200'
            },
            webhookUrl: 'https://boulevard.r-y-x.net/api/v1/Courier/UpdateCourierStatus'
        };

        // ==================== State Management ====================
        let state = {
            orders: [],
            logs: [],
            stats: {
                total: 0,
                successful: 0,
                failed: 0,
                totalAmount: 0
            },
            walletBalance: null
        };

        // ==================== Utility Functions ====================
        function generateOrderId() {
            return 'ORD-' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 4).toUpperCase();
        }

        function formatDate(date = new Date()) {
            return date.toLocaleString('ar-EG', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');

            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };

            icon.textContent = icons[type] || icons.info;
            msg.textContent = message;

            toast.classList.remove('translate-y-20', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function addLog(message, type = 'info', details = null) {
            const timestamp = formatDate();
            const colors = {
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400',
                info: 'text-blue-400'
            };

            const icons = {
                success: 'âœ“',
                error: 'âœ—',
                warning: 'âš ',
                info: 'â„¹'
            };

            const log = { timestamp, message, type, details };
            state.logs.unshift(log);

            const logsContainer = document.getElementById('logsContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${colors[type]} py-1 border-b border-gray-800`;
            logEntry.dataset.type = type;

            let detailsHtml = '';
            if (details) {
                detailsHtml = `<pre class="text-xs text-gray-500 mt-1 mr-6">${JSON.stringify(details, null, 2)}</pre>`;
            }

            logEntry.innerHTML = `
                <span class="text-gray-500">[${timestamp}]</span>
                <span class="font-bold">${icons[type]}</span>
                <span>${message}</span>
                ${detailsHtml}
            `;

            if (logsContainer.firstChild && logsContainer.firstChild.classList && logsContainer.firstChild.classList.contains('text-gray-500')) {
                logsContainer.innerHTML = '';
            }

            logsContainer.insertBefore(logEntry, logsContainer.firstChild);
        }

        function filterLogs(filter) {
            document.querySelectorAll('.log-filter').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2', 'ring-purple-500');
            });
            event.target.classList.add('ring-2', 'ring-offset-2', 'ring-purple-500');

            document.querySelectorAll('.log-entry').forEach(entry => {
                if (filter === 'all' || entry.dataset.type === filter) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            });
        }

        function clearLogs() {
            state.logs = [];
            document.getElementById('logsContainer').innerHTML = '<div class="text-gray-500">// Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>';
            showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'info');
        }

        function updateStats() {
            document.getElementById('totalOrders').textContent = state.stats.total;
            document.getElementById('successfulOrders').textContent = state.stats.successful;
            document.getElementById('failedOrders').textContent = state.stats.failed;
            document.getElementById('totalAmount').textContent = state.stats.totalAmount.toLocaleString();
        }

        function updateActiveOrders() {
            const container = document.getElementById('activeOrders');
            if (state.orders.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 text-sm py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</div>';
                return;
            }

            container.innerHTML = state.orders.slice(0, 10).map(order => `
                <div class="bg-gray-50 rounded-lg p-3 border-r-4 ${getStatusBorderColor(order.status)}">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-semibold text-sm">${order.id}</div>
                            <div class="text-xs text-gray-500">${order.customerName}</div>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full ${getStatusBadgeColor(order.status)}">
                            ${order.status}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mt-1">${order.value.toLocaleString()} Ø±.ÙŠ</div>
                </div>
            `).join('');
        }

        function getStatusBorderColor(status) {
            const colors = {
                'Pending': 'border-yellow-500',
                'Assigned': 'border-blue-500',
                'Out for Delivery': 'border-purple-500',
                'Delivered': 'border-green-500',
                'Cancelled': 'border-red-500'
            };
            return colors[status] || 'border-gray-300';
        }

        function getStatusBadgeColor(status) {
            const colors = {
                'Pending': 'bg-yellow-100 text-yellow-700',
                'Assigned': 'bg-blue-100 text-blue-700',
                'Out for Delivery': 'bg-purple-100 text-purple-700',
                'Delivered': 'bg-green-100 text-green-700',
                'Cancelled': 'bg-red-100 text-red-700'
            };
            return colors[status] || 'bg-gray-100 text-gray-700';
        }

        // ==================== API Functions ====================

        // Get configuration values from inputs
        function getConfig() {
            return {
                jeebly: {
                    baseUrl: document.getElementById('jeeblyBaseUrl').value,
                    clientKey: document.getElementById('jeeblyClientKey').value,
                    apiKey: document.getElementById('jeeblyApiKey').value
                }
            };
        }

        // Test connection to Jeebly via Laravel API
        async function testConnection() {
            const config = getConfig();
            addLog('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Jeebly...', 'info');

            document.getElementById('connectionStatusText').textContent = 'Ø¬Ø§Ø±ÙŠ...';

            try {
                const response = await fetch(CONFIG.laravelApiUrl + '/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        base_url: config.jeebly.baseUrl,
                        client_key: config.jeebly.clientKey,
                        api_key: config.jeebly.apiKey
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('connectionStatusText').textContent = 'Ù…ØªØµÙ„ âœ“';
                    document.getElementById('connectionStatus').classList.remove('bg-white/20');
                    document.getElementById('connectionStatus').classList.add('bg-green-500/30');
                    addLog('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Jeebly Ø¨Ù†Ø¬Ø§Ø­', 'success', data);
                    showToast('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    document.getElementById('connectionStatusText').textContent = 'ÙØ´Ù„';
                    document.getElementById('connectionStatus').classList.remove('bg-white/20');
                    document.getElementById('connectionStatus').classList.add('bg-red-500/30');
                    addLog('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + (data.message || 'Unknown error'), 'error');
                    showToast('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
                }
            } catch (error) {
                document.getElementById('connectionStatusText').textContent = 'Ø®Ø·Ø£';
                addLog('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
            }
        }

        function showLowBalanceAlert(balance) {
            const modal = document.getElementById('lowBalanceModal');
            document.getElementById('modalBalance').textContent = balance.toLocaleString();
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeLowBalanceModal() {
            const modal = document.getElementById('lowBalanceModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Submit Order to Jeebly via Laravel API (REAL API CALL)
        async function submitJeeblyOrder(orderData) {
            const config = getConfig();
            addLog(`Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¥Ù„Ù‰ Jeebly: ${orderData.id}`, 'info');

            const requestBody = {
                // Jeebly config
                base_url: config.jeebly.baseUrl,
                client_key: config.jeebly.clientKey,
                api_key: config.jeebly.apiKey,
                // Order data
                order_id: orderData.id,
                customer_name: orderData.customerName,
                customer_phone: orderData.customerPhone,
                customer_address: orderData.customerAddress,
                order_value: orderData.value,
                delivery_fee: orderData.deliveryFee,
                product_description: orderData.productDescription
            };

            // Show request being sent
            document.getElementById('jeeblyResponse').innerHTML = `
                <div class="text-yellow-400 mb-2">// Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...</div>
                <pre class="text-gray-500">${JSON.stringify(requestBody, null, 2)}</pre>
            `;

            try {
                const response = await fetch(CONFIG.laravelApiUrl + '/order/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.success) {
                    // Update response display
                    document.getElementById('jeeblyResponse').innerHTML = `
                        <div class="text-green-400 mb-2">// Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Jeebly âœ“</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;

                    // Add to orders
                    state.orders.unshift({
                        ...orderData,
                        status: 'Pending',
                        jeeblyOrderId: data.data?.jeebly_order_id || data.order_id
                    });

                    state.stats.total++;
                    state.stats.successful++;
                    state.stats.totalAmount += orderData.value;

                    updateStats();
                    updateActiveOrders();

                    addLog(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­: ${orderData.id}`, 'success', data);
                    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù€ Jeebly Ø¨Ù†Ø¬Ø§Ø­!', 'success');

                    return data;
                } else {
                    // Handle Jeebly error (like low wallet balance)
                    document.getElementById('jeeblyResponse').innerHTML = `
                        <div class="text-red-400 mb-2">// Ø®Ø·Ø£ Ù…Ù† Jeebly âœ—</div>
                        <pre class="text-red-300">${JSON.stringify(data, null, 2)}</pre>
                    `;

                    state.stats.total++;
                    state.stats.failed++;
                    updateStats();

                    // Check for wallet balance error
                    if (data.message && data.message.toLowerCase().includes('wallet')) {
                        showLowBalanceAlert(0);
                        addLog('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨: Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù†Ø®ÙØ¶', 'error', data);
                    } else {
                        addLog(`ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨: ${data.message}`, 'error', data);
                    }
                    showToast('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'error');

                    throw new Error(data.message || 'Unknown error');
                }
            } catch (error) {
                if (!document.getElementById('jeeblyResponse').innerHTML.includes('Ø®Ø·Ø£')) {
                    document.getElementById('jeeblyResponse').innerHTML = `
                        <div class="text-red-400 mb-2">// Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ âœ—</div>
                        <pre class="text-red-300">${JSON.stringify({ error: error.message }, null, 2)}</pre>
                    `;
                }

                if (!state.stats.failed) {
                    state.stats.total++;
                    state.stats.failed++;
                    updateStats();
                }

                addLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
                throw error;
            }
        }

        // Simulate Webhook Event
        function simulateWebhook() {
            const status = document.getElementById('manualStatus').value;
            const orderId = state.orders.length > 0 ? state.orders[0].id : generateOrderId();

            const webhookData = {
                order_id: orderId,
                status: status,
                timestamp: new Date().toISOString(),
                courier_name: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯',
                notes: getStatusNote(status)
            };

            addWebhookEvent(webhookData);

            // Update order status if exists
            const order = state.orders.find(o => o.id === orderId);
            if (order) {
                order.status = status === 'Low Wallet Balance' ? 'Pending' : status;
                updateActiveOrders();
            }

            // Handle special cases
            if (status === 'Delivered') {
                addLog(`ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ ${orderId} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                showToast('ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
            } else if (status === 'Cancelled') {
                addLog(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ${orderId} - Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ†`, 'warning');
                showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'warning');
            } else if (status === 'Low Wallet Balance') {
                showLowBalanceAlert(500);
                addLog(`ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨: Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± ÙƒØ§ÙÙŠ`, 'error');
            } else {
                addLog(`ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${orderId}: ${status}`, 'info');
            }
        }

        function getStatusNote(status) {
            const notes = {
                'Assigned': 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…Ù†Ø¯ÙˆØ¨ Ù„Ù„Ø·Ù„Ø¨',
                'Out for Delivery': 'Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„Ù„Ø¹Ù…ÙŠÙ„',
                'Delivered': 'ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­',
                'Cancelled': 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„',
                'Low Wallet Balance': 'Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨'
            };
            return notes[status] || '';
        }

        function addWebhookEvent(data) {
            addWebhookEventToUI(data, new Date().toISOString());
        }

        function addWebhookEventToUI(data, receivedAt) {
            const container = document.getElementById('webhookEvents');

            // Remove placeholder if exists
            if (container.querySelector('.text-gray-400')) {
                container.innerHTML = '';
            }

            const statusColors = {
                'Assigned': 'bg-blue-100 text-blue-700 border-blue-300',
                'Out for Delivery': 'bg-purple-100 text-purple-700 border-purple-300',
                'Delivered': 'bg-green-100 text-green-700 border-green-300',
                'Cancelled': 'bg-red-100 text-red-700 border-red-300',
                'Low Wallet Balance': 'bg-yellow-100 text-yellow-700 border-yellow-300'
            };

            const statusIcons = {
                'Assigned': 'ğŸ“‹',
                'Out for Delivery': 'ğŸšš',
                'Delivered': 'âœ…',
                'Cancelled': 'âŒ',
                'Low Wallet Balance': 'âš ï¸'
            };

            const status = data.status || 'Unknown';
            const eventDiv = document.createElement('div');
            eventDiv.className = `p-3 rounded-lg border ${statusColors[status] || 'bg-gray-100 text-gray-700 border-gray-300'} log-entry`;
            eventDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="font-semibold">${statusIcons[status] || 'ğŸ“¦'} ${status}</span>
                    <span class="text-xs">${formatDate(new Date(receivedAt))}</span>
                </div>
                <div class="text-xs mt-1">
                    <div>Ø§Ù„Ø·Ù„Ø¨: ${data.order_id || 'N/A'}</div>
                    ${data.rider_name ? `<div>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${data.rider_name}</div>` : ''}
                    ${data.rider_phone ? `<div>Ù‡Ø§ØªÙ: ${data.rider_phone}</div>` : ''}
                </div>
            `;

            container.insertBefore(eventDiv, container.firstChild);
        }

        // Bulk Test Function
        async function runBulkTest() {
            addLog('Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ (5 Ø·Ù„Ø¨Ø§Øª)...', 'info');
            showToast('Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ...', 'info');

            const testOrders = [
                { customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', customerPhone: '967777111111', customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†', value: 5000, deliveryFee: 500, productDescription: 'Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ' },
                { customerName: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', customerPhone: '967777222222', customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø­Ø¯Ø©', value: 3500, deliveryFee: 500, productDescription: 'Ø­Ù‚ÙŠØ¨Ø© Ø¬Ù„Ø¯ÙŠØ©' },
                { customerName: 'Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯', customerPhone: '967777333333', customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±', value: 8000, deliveryFee: 700, productDescription: 'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©' },
                { customerName: 'ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯', customerPhone: '967777444444', customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø§Ù„Ø²Ø¨ÙŠØ±ÙŠ', value: 2500, deliveryFee: 400, productDescription: 'Ù†Ø¸Ø§Ø±Ø© Ø´Ù…Ø³ÙŠØ©' },
                { customerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ø³Ù†', customerPhone: '967777555555', customerAddress: 'ØµÙ†Ø¹Ø§Ø¡ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø·Ø§Ø±', value: 12000, deliveryFee: 800, productDescription: 'Ù‡Ø§ØªÙ Ø°ÙƒÙŠ' }
            ];

            let successCount = 0;
            let failCount = 0;

            for (let i = 0; i < testOrders.length; i++) {
                const order = testOrders[i];
                order.id = generateOrderId();

                try {
                    await submitJeeblyOrder(order);
                    successCount++;
                    await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between requests
                } catch (error) {
                    failCount++;
                }
            }

            addLog(`Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ: ${successCount} Ù†Ø¬Ø§Ø­ØŒ ${failCount} ÙØ´Ù„`, successCount === 5 ? 'success' : 'warning');
            showToast(`Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${successCount}/5 Ø·Ù„Ø¨Ø§Øª Ù†Ø§Ø¬Ø­Ø©`, successCount === 5 ? 'success' : 'warning');
        }

        // ==================== Webhook Functions ====================

        // Fetch real webhook events from server
        async function fetchWebhookEvents() {
            try {
                const response = await fetch(CONFIG.laravelApiUrl + '/webhook-events', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                const data = await response.json();

                if (data.success && data.events && data.events.length > 0) {
                    const container = document.getElementById('webhookEvents');
                    container.innerHTML = '';

                    data.events.forEach(event => {
                        addWebhookEventToUI(event.data, event.received_at);
                    });
                }
            } catch (error) {
                console.log('Could not fetch webhook events:', error.message);
            }
        }

        // ==================== Track Order Function ====================

        async function trackOrder() {
            const orderId = document.getElementById('trackOrderId').value.trim();

            if (!orderId) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨', 'warning');
                return;
            }

            const config = getConfig();
            addLog(`ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨: ${orderId}`, 'info');

            document.getElementById('trackingResult').classList.add('hidden');
            document.getElementById('trackOrderId').disabled = true;

            try {
                const response = await fetch(CONFIG.laravelApiUrl + '/order/track', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        base_url: config.jeebly.baseUrl,
                        client_key: config.jeebly.clientKey,
                        api_key: config.jeebly.apiKey,
                        order_id: orderId
                    })
                });

                const data = await response.json();

                document.getElementById('trackingResult').classList.remove('hidden');

                const statusColors = {
                    'Pending': 'bg-yellow-100 text-yellow-700',
                    'Assigned': 'bg-blue-100 text-blue-700',
                    'Picked up': 'bg-indigo-100 text-indigo-700',
                    'Out for Delivery': 'bg-purple-100 text-purple-700',
                    'Delivered': 'bg-green-100 text-green-700',
                    'Cancelled': 'bg-red-100 text-red-700',
                    'Returned': 'bg-gray-100 text-gray-700'
                };

                if (data.success && data.data) {
                    const orderData = data.data;
                    const status = orderData.status || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

                    document.getElementById('trackingStatus').className =
                        `px-3 py-1 rounded-full text-sm font-semibold ${statusColors[status] || 'bg-gray-100 text-gray-700'}`;
                    document.getElementById('trackingStatus').textContent = status;

                    document.getElementById('trackingDetails').innerHTML = `
                        <div class="grid grid-cols-2 gap-2">
                            ${orderData.awb ? `<div><strong>AWB:</strong> ${orderData.awb}</div>` : ''}
                            ${orderData.rider_name ? `<div><strong>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:</strong> ${orderData.rider_name}</div>` : ''}
                            ${orderData.rider_phone ? `<div><strong>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:</strong> ${orderData.rider_phone}</div>` : ''}
                            ${orderData.cod_amount ? `<div><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> ${orderData.cod_amount} Ø±.ÙŠ</div>` : ''}
                            ${orderData.created_at ? `<div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${orderData.created_at}</div>` : ''}
                            ${orderData.updated_at ? `<div><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${orderData.updated_at}</div>` : ''}
                        </div>
                        ${orderData.timeline ? `
                            <div class="mt-3 pt-3 border-t">
                                <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong>
                                <div class="mt-2 space-y-1">
                                    ${orderData.timeline.map(t => `
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                                            <span>${t.status}</span>
                                            <span class="text-gray-400">${t.timestamp || ''}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    `;

                    addLog(`ØªÙ… ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ ${orderId}: ${status}`, 'success', data.data);
                    showToast(`Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: ${status}`, 'success');
                } else {
                    document.getElementById('trackingStatus').className =
                        'px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-700';
                    document.getElementById('trackingStatus').textContent = 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
                    document.getElementById('trackingDetails').innerHTML = `
                        <div class="text-red-600">
                            ${data.message || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨'}
                        </div>
                        <pre class="text-xs text-gray-500 mt-2">${JSON.stringify(data, null, 2)}</pre>
                    `;

                    addLog(`ÙØ´Ù„ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ ${orderId}`, 'error', data);
                    showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨', 'error');
                }
            } catch (error) {
                document.getElementById('trackingResult').classList.remove('hidden');
                document.getElementById('trackingStatus').className =
                    'px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-700';
                document.getElementById('trackingStatus').textContent = 'Ø®Ø·Ø£';
                document.getElementById('trackingDetails').innerHTML = `
                    <div class="text-red-600">${error.message}</div>
                `;
                addLog(`Ø®Ø·Ø£ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨: ${error.message}`, 'error');
            } finally {
                document.getElementById('trackOrderId').disabled = false;
            }
        }

        function refreshActiveOrders() {
            // Refresh orders from local state
            updateActiveOrders();
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'info');
        }

        // ==================== Event Listeners ====================

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const orderData = {
                id: generateOrderId(),
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerAddress: document.getElementById('customerAddress').value,
                value: parseFloat(document.getElementById('orderValue').value),
                deliveryFee: parseFloat(document.getElementById('deliveryFee').value) || 500,
                productDescription: document.getElementById('productDescription').value || 'Ù…Ù†ØªØ¬'
            };

            try {
                await submitJeeblyOrder(orderData);
                e.target.reset();
                document.getElementById('deliveryFee').value = '500';
            } catch (error) {
                console.error('Order submission failed:', error);
            }
        });

        // Save configuration to localStorage
        function saveConfig() {
            const config = getConfig();
            localStorage.setItem('integrationTestConfig', JSON.stringify(config));
        }

        function loadConfig() {
            const saved = localStorage.getItem('integrationTestConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    if (config.jeebly) {
                        document.getElementById('jeeblyBaseUrl').value = config.jeebly.baseUrl || CONFIG.jeebly.baseUrl;
                        document.getElementById('jeeblyClientKey').value = config.jeebly.clientKey || CONFIG.jeebly.clientKey;
                        document.getElementById('jeeblyApiKey').value = config.jeebly.apiKey || CONFIG.jeebly.apiKey;
                    }
                } catch (e) {
                    console.error('Failed to load config:', e);
                }
            }
        }

        // Auto-save configuration on input change
        document.querySelectorAll('#jeeblyBaseUrl, #jeeblyClientKey, #jeeblyApiKey').forEach(input => {
            input.addEventListener('change', saveConfig);
        });

        // ==================== Initialization ====================

        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            addLog('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Ø±Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠ', 'success');
            addLog('Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Jeebly API', 'warning');

            // Fetch existing webhook events
            fetchWebhookEvents();

            // Test connection on load
            setTimeout(() => {
                testConnection();
            }, 1000);
        });

        // Poll for new webhook events every 10 seconds
        setInterval(() => {
            fetchWebhookEvents();
        }, 10000);
    </script>
</body>
</html>
